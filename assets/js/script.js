//end of json data set

var lang = "de";

var calc2_title_de = `Markerunspezifische Umrechnung`;
var calc2_title_en = `Marker-unspecific conversion`;

var desc_title_en =`Project Description`;

var logo_en = `assets/img/uzh_logo_en.png`;

var description_en = `<h5 class="text-center">UZH Unit Converter</h5>
            <p class="text-justify">Steroid hormones, neuroactive steroids, and neurotransmitters are critical for the investigation of human physiological processes but also the development of disease and disability. Numerous psychobiological studies have included respective markers in their design and there is vast literature from different tissues (i.e. blood, saliva, urine, hair), quantified with various assay techniques (i.e. ELISA, RIA, LC MS/MS). Depending on the tissue and assay, results are presented in different units (i.e. pg/ml, pmol/L), with varying standard ranges. This renders the comparison between studies complex and limits conclusions across studies.</p>

            <p class="text-justify">One simple, but yet efficient way to increase comparability of results across studies, is to simplify the <b>conversion of different chemical units</b> into one another. To do so, basic knowledge about the molar mass of each marker is necessary. As an example, one can transfer the amount of free testosterone from pg/ml to pmol/L by multiplying it by 3.47 (conversion factor). To spare other researchers and clinicians the time-consuming extra mile of unit conversion, we hereby provide a simple and quick open access conversion tool, <b>The University of Zurich (UZH) Unit Converter</b>.</p>

            <p class="text-justify"><b>The UZH Unity Converter</b> tool covers the <b>most frequently used chemical units of important markers in biopsychological research</b>. We provide the UZH Unit Converter as an open access tool, as we wish that anyone interested will be able to transfer results quickly, easily, and free of cost and, by doing so, increase the value of published literature.</p>

            <p class="text-justify">The UZH Unit Converter mask is divided into two types of calculations: Marker-specific and marker-unspecific unit conversions. The marker-specific conversion considers the unique molar mass of every of the proposed marker from the drop-down menu on the top right (e.g. Cortisol). The molar mass is needed for all conversions to or from a unit including a mol (e.g. from pg/l to nmol/l or vice versa). The marker-unspecific conversion is independent from the molar mass, providing a simpler conversion based on the molecular weight. Essentially, the marker-unspecific conversion is a multiplication or division, resulting a simple shift of the comma (e.g. 10 pg/l are 1 pg/dl or .01 pg/ml, independent of whether it is Cortisol or Testosterone).</p>

            <p class="text-justify">Please note that for the direct comparison of results from one study to another or to a published reference range, it is necessary to compare within the same biological medium (e.g. saliva with saliva, blood serum with blood serum), while considering age and the population of interest. Pregnant women will have different reference ranges of progesterone than non-pregnant women of the same age. Another caveat are upper and lower detection limits, which depend on the used biochemical assay and are especially critical in populations such as aging men or postmenopausal women with known low concentrations of, for example, estrogens and testosterone.</p>`;


var logo_de = `assets/img/uzh_logo_de.png`;

var desc_title_de =`Projektbeschreibung`;

var description_de =`<h5 class="text-center">UZH Masseneinheitsrechner</h5>

<p class="text-justify">Steroidhormone, neuroaktive Steroide und Neurotransmitter sind sowohl für das Verständnis der Entstehung von Krankheiten als auch für die Erforschung grundlegender physiologischer Prozesse von zentraler Bedeutung. Zahlreiche psychobiologische Studien beziehen entsprechende Marker in ihr Studiendesign ein und so können diese Marker aus unterschiedlichen Gewebeproben (z.B. Blut, Urin, Haar, Speichel) mit diversen biochemischen Analyseverfahren und Techniken (z.B. ELISA, RIA, LC MS/MS) gemessen werden. In Abhängigkeit davon, welches Gewebe und welche Untersuchungsmethode verwendet wird, werden die Ergebnisse anhand entsprechend unterschiedlicher Einheiten (z.B. pg/ml, pmol/L) und Standardkurven dargestellt. Das verkompliziert den Vergleich von Ergebnissen zwischen Studien und erschwert die studienübergreifende Interpretation von Befunden.</p>

<p class="text-justify">Ein einfacher, aber effizienter Weg, um die Vergleichbarkeit von Ergebnissen zu verbessern ist es, die <b>Umrechnung verschiedener chemischer Einheiten</b> zu erleichtern. Hierzu ist ein grundlegendes Wissen über die molare Masse eines spezifischen Markers notwendig. Möchte man beispielsweise die Konzentration von freiem Testosteron von pg/ml zu pmol/L umrechnen, multipliziert man den Ausgangswert mit 3.47 (Umrechnungsfaktor). Um anderen Wissenschaftler:innen und Kliniker:innen diesen zusätzlichen Arbeits- und Zeitaufwand zu ersparen, möchten wir hiermit ein einfaches, schnelles und frei zugängliches Umrechnungsinstrument anbieten, den <b>Universität Zürich (UZH) Masseneinheitsrechner</b>.</p>

<p class="text-justify">Der UZH Masseneinheitsrechner beinhaltet die am häufigsten vorkommenden chemischen Einheiten zentraler Marker in der biopsychologischen Forschung. Wir bieten den UZH Masseneinheitsrechner als frei zugängliches Online-Tool an, damit interessierte Wissenschaftler:innen und Kliniker:innen Ergebnisse schnell, einfach und kostenfrei umrechnen können.</p>

<p class="text-justify">Der UZH-Masseneinheisrechner umfasst zwei verschiedene Umrechnungsformen, die markerspezifische und die markerunspezifische Umrechnung. Die markerspezifische Umrechnung bezieht die spezifische molare Masse jedes Markers mit ein, der im Drop-Down Menü auf der rechten Seite angezeigt wird (z.B. Kortisol). Der Wert der molaren Masse wird für jene Umrechnungen gebraucht, in denen die Ausgangseinheit oder die Zieleinheit ein Mol beinhalten (z.B. von pg/l zu nmol/l oder umgekehrt). Die markerunspezifische Umrechnung hingegen ist unabhängig von der molaren Masse und führt somit einfachere Umrechnungen aus, die auf dem Molekulargewicht basieren. Im Wesentlichen ist die markerunspezifische Umrechnung eine Multiplikation oder Division, die sich in einer einfachen Kommaverschiebung zeigt (z.B. 10 pg/l = 1 pg/dl oder .01 pg/ml, unabhängig davon ob es sich um Cortisol oder Testosteron handelt).</p>

<p class="text-justify">Folgendes sollte bei der Umrechnung weiterhin beachtet werden: Für die direkte Vergleichbarkeit von Ergebnissen zwischen Studien oder dem Vergleich mit publizierten Referenzenwerten muss darauf geachtet werden, dass nur innerhalb eines biologischen Mediums (z.B. Speichel mit Speichel, Blutserum mit Blutserum) verglichen wird. Zudem sollten Populationsmerkmale wie Alter und Geschlecht beachtet werden. Schwangere Frauen zeigen beispielsweise andere Referenzwerte für Progesteron als nicht-schwangere Frauen im gleichen Alter. Weiterhin besitzen unterschiedliche biochemische Analyseverfahren unterschiedliche Messbereiche, in denen vorliegende Konzentrationen (minimal oder maximal) messbar sind. Diese Messbereiche sind besonders in Populationen mit niedrigen Konzentrationen zu beachten, wozu beispielsweise Männer im fortgeschrittenen Alter oder postmenopausale Frauen mit eher niedrigen Östrogen- und Testosteronwerten gehören. </p>`;


function format(num) {
    return parseFloat(num).toFixed(12);
    
}


function showhelp(){

    $('#modal_btn').click();

}


function error(message){

    var warningText = "Warning";

    if(lang == "de"){

        warningText = "Warnung";

    }

    return  `<div class="wtg-alert wtg-alert-danger" style="width:90%;margin:0 auto;"><div class="wtg-alert-title"><i class="wtg-alert-icon glyphicon glyphicon-star "></i><strong>${warningText}</strong></div><p class="wtg-alert-text">${message}</p></div>
        
        <script> 

        setTimeout(function() {

            //alert("wawa00");

          $("#error").html("");

      }, 2000);</script>`;

}


 function err(lang_){

                                var err = "";

                                if(lang_ == "en"){

                                    err = "Not defined";

                                } else {

                                     err = "Nicht definiert";

                                } 

                                return err;        

                        }





$(document).ready(function() {


var d = new Date();

var month = d.getMonth()+1;
var day = d.getDate();

var output = (day<10 ? '0' : '')+day+'.'+(month<10 ? '0' : '') + month + '.' +
     d.getFullYear()  ;
 
 $('#date').text(output);



var setNum = 1;

$("#variants").change(function(){

        var variant = $("#variants").val();

        if(variant == "Allopregnanolon" || variant == "Ostradiol" || variant == "Testosteron" || variant == "Progesteron" || variant == "Pregnanolon" || variant == "CRH" || variant == "GABA" || variant == "DHEAS" || variant == "Antimüller-Hormon" || variant == "ACTH"){

            setNum = 1;

            update_options(1);
            //alert("set_1");

        } else if(variant == "FSH" || variant == "LH" ){

            setNum = 2;

            update_options(2);

        } else if(variant == "Kortisol"){

            setNum = 3;

            update_options(3);

        } else {

            setNum = 4;

            update_options(4);

        } 
 


});




changeLang("de");
 //for the language toggle switches

            $("#en").click(function(){

              $("#en").css({"background-color": "#f0ffff", "font-weight": "900", "color": "#27273c"});

              $("#de").css({"background-color": "#6c757d", "font-weight": "200", "color": "#fff"});

              lang = "en";

              changeLang("en");

            }); 


             

            $("#de").click(function(){

               $("#de").css({"background-color": "#f0ffff", "font-weight": "900", "color": "#27273c"});

              $("#en").css({"background-color": "#6c757d", "font-weight": "200", "color": "#fff"});

              lang = "de";

              changeLang("de");

            });     


function changeLang(language){

    if(language == "en"){

        $(".titleText").text("UZH Unit Converter");
        $(".valueText").text("Value");

        $(".markerText").text("Marker");
        $(".fromText").text("Convert from");
        $(".toText").text("To");
        $(".goText").text("Go");
        $("#authors").text("Authors");

        $(".resultText").text("Result");
        $("#footerText").text("All specifications without guarantee and excluding all liability.");

        $("#deptText").html("<strong>Psychological Institute </strong><br /><strong>Department of Psychology, Clinical Psychology & Psychotherapy Chair</strong>");
        $("#calc_title").text("Marker-specific conversion");
        $("#calc2_title").text(calc2_title_en);

        $(".modal_text").html(description_en);
        $(".modal-title").html(desc_title_en);

        $("#logo").attr('src', logo_en);


    } else { //de German

        $(".titleText").text("UZH Masseneinheitsrechner");
        $(".valueText").text("Zahl");
        $("#authors").text("Autoren");

        $(".markerText").text("Marker");
        $(".fromText").text("Konvertieren von");
        $(".toText").text("Zu");
        $(".goText").text("Lösen");

        $(".resultText").text("Ergebnis");

        $("#footerText").text("Alle Angaben ohne Gewähr und ohne jegliche Haftung.");

        $("#deptText").html("<strong>Psychologisches Institut </strong><br /><strong>Abteilung für Klinische Psychologie &amp; Psychotherapie</strong>");
        $("#calc_title").text("Markerspezifische Umrechnung");
        $("#calc2_title").text(calc2_title_de);

        $(".modal_text").html(description_de);
        $(".modal-title").html(desc_title_de);

         $("#logo").attr('src', logo_de);


    }


}


function update_options(num){

    if (num === 1){

        $("#set_container_1").html(options_a1);
        $("#set_container_2").html(options_b1);

    } else if (num === 2){

        $("#set_container_1").html(options_a2);
        $("#set_container_2").html(options_b2);

    } else if (num === 3){

        $("#set_container_1").html(options_a3);
        $("#set_container_2").html(options_b3);

    } else{

        $("#set_container_1").html(options_a4);
        $("#set_container_2").html(options_b4);
    }

}



 

 
    var valToConvert;
    var proceed = 1;

   $("#calc").click(function(){

    var comma = false;

    $("#error").html("");

    
    valToConvert = $("#valToConvert").val();


    if (valToConvert.indexOf(',') > -1) {

        valToConvert =  valToConvert.replace(",", ".");
        comma = true;
    }

    


     if(!$.isNumeric(valToConvert)){

        proceed = 0;

            if(lang == "en"){

                var message = "This system expects a number. Please review entry."

            } else {

                var message = "Dieses System erwartet eine Nummer. Bitte überprüfen Sie den Eintrag."

            }


        //$("#error").html(error(message));
        $("#result").val(message);

        setTimeout(function() {

            if($("#result").val() == message){

                $("#result").val("");

            }       

         }, 2000);



     } else{
        proceed = 1;
     }

     if(proceed){


     $("#result").val("");

     var first_param = $("#param_1 :input").val();
     var second_param = $("#param_2 :input").val();

     var variable_id  = $("#variants").val();

     if(first_param === second_param){

             $("#result").val(valToConvert);
     }

     else if(setNum === 1){

        $.each(data_1, function(i, v) {
                    if ((v.Unit_1 == first_param) && (v.Unit_2 == second_param)) {
                        
                        // found it...
                        //alert(v.variable_1);

                       // alert(valToConvert);

                        var result = v[variable_id];
                        
                        result = result * valToConvert;
                        result = format(result);

                        if(comma){
                            result = result.replace(".", ",");
                        }
                        
                        $("#result").val(result);

                        
                        return false; // stops the loop
                    }else{


                        $("#result").val(err(lang));

                    }
            });


     } else if(setNum === 2){

        
        $.each(data_2, function(i, v) {
                    if ((v.Unit_1 == first_param) && (v.Unit_2 == second_param)) {
                        
                        // found it...
                        //alert(v.variable_1);

                       // alert(valToConvert);

                        var result = v[variable_id];
                        
                        result = result * valToConvert;
                        result = format(result);

                        if(comma){
                            result = result.replace(".", ",");
                        }
                        
                        $("#result").val(result);


                        
                        return false; // stops the loop
                    }else{

                         $("#result").val(err(lang));

                    }
            });


     } else if(setNum === 3){


        $.each(data_3, function(i, v) {
                    if ((v.Unit_1 == first_param) && (v.Unit_2 == second_param)) {
                        
                        // found it...
                        //alert(v.variable_1);

                       // alert(valToConvert);

                        var result = v[variable_id];
                        
                        result = result * valToConvert;
                        result = format(result);

                        if(comma){
                            result = result.replace(".", ",");
                        }
                        
                        $("#result").val(result);

                        
                        return false; // stops the loop
                    } else{

                          $("#result").val(err(lang));

                    }
            });


     } else {
       
        $.each(data_4, function(i, v) {

                    if ((v.Unit_1 == first_param) && (v.Unit_2 == second_param)) {
                        
                        // found it...
                        //alert(v.variable_1);

                       // alert(valToConvert);

                        var result = v[variable_id];
                        
                        result = result * valToConvert;
                        result = format(result);

                        if(comma){
                            result = result.replace(".", ",");
                        }
                        
                        $("#result").val(result);


                        
                        return false; // stops the loop
                    }else{

                          $("#result").val(err(lang));

                    }
            });


     }
 
                 
    }//proceed

  //alert("The paragraph was clicked."+first_param+","+second_param); passed

});



 //swap select fields
 $("#swap_btn").click(function(){

     //capture values
     var first_param = $("#param_1 :input").val();
     var second_param = $("#param_2 :input").val(); 

     //var set_1 = $("#set_container_1 span").text();

     var element_1 = $("#set_container_1").html();
     var element_2 = $("#set_container_2").html();

        $("#set_container_1").html(element_2);
        $("#set_container_2").html(element_1);

         $("#param_1 :input").val(second_param);
     $("#param_2 :input").val(first_param);

   
 // alert("initset."+set_1);
});


});


